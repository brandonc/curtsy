<!DOCTYPE html />
<html>
<head>
	<title>Program.cs</title>
	<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
	<link href="curtsy.css" rel="stylesheet" media="all" type="text/css" />
	<script src="prettify.js" type="text/javascript"></script>
</head>
<body onload="prettyPrint()">
	<div id="container">
		<div id="background"></div>
			<div id="sources" class="dd">
				Program.cs
                <div class="ddbtn"></div>
                <header></header>
                <nav>
                    <table border="0" cellspacing="0">
							<tr>
                                <td class="size">8.64 KB</td>
                                <td><a class="source" href="curtsy.html">
								    Curtsy.cs
							    </a></td>
                            </tr>
							<tr>
                                <td class="size">37.19 KB</td>
                                <td><a class="source" href="extensions/stringregexextensions.html">
								    Extensions\StringRegexExtensions.cs
							    </a></td>
                            </tr>
							<tr>
                                <td class="size">1.76 KB</td>
                                <td><a class="source" href="foundtypes.html">
								    FoundTypes.cs
							    </a></td>
                            </tr>
							<tr>
                                <td class="size">12.6 KB</td>
                                <td><a class="source" href="parser,lexer.html">
								    Parser,Lexer.cs
							    </a></td>
                            </tr>
							<tr>
                                <td class="size">1.02 KB</td>
                                <td><a class="source" href="pathhelper.html">
								    PathHelper.cs
							    </a></td>
                            </tr>
							<tr>
                                <td class="size">3.26 KB</td>
                                <td><a class="source" href="program.html">
								    Program.cs
							    </a></td>
                            </tr>
							<tr>
                                <td class="size">1.46 KB</td>
                                <td><a class="source" href="properties/assemblyinfo.html">
								    Properties\AssemblyInfo.cs
							    </a></td>
                            </tr>
							<tr>
                                <td class="size">4.16 KB</td>
                                <td><a class="source" href="embeddedresources.html">
								    EmbeddedResources.cs
							    </a></td>
                            </tr>
							<tr>
                                <td class="size">644 B</td>
                                <td><a class="source" href="section.html">
								    Section.cs
							    </a></td>
                            </tr>
							<tr>
                                <td class="size">1.19 KB</td>
                                <td><a class="source" href="templatebase.html">
								    TemplateBase.cs
							    </a></td>
                            </tr>
                    </table>
				</nav>
			</div>
		<table cellpadding="0" cellspacing="0">
			<thead>
				<tr>
					<th class="docs">
						<h1>Program.cs</h1>
					</th>
                    <th class="lines"></th>
					<th class="code">&nbsp;</th>
				</tr>
			</thead>
			<tbody>
					<tr id="section_1">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_1">&#182;</a>
							</div>
							
						</td>
                        <td class="lines">
1<br />
2<br />
3<br />
4<br />
5<br />
6<br />
7<br />
8<br />
9<br />
10<br />
11<br />
12<br />
13<br />
14<br />
15<br />
16<br />
17<br />
18<br />
                        </td>
						<td class="code">
							<pre><code class='prettyprint'>#if DEBUG
#define VERBOSE
#endif

using System;
using System.CodeDom.Compiler;
using System.Collections.Generic;
using System.IO;
using System.Linq;
using System.Reflection;
using System.Text;
using System.Web.Razor;
using System.Xml;
using System.Collections;

namespace Curtsy
{
</code></pre>
						</td>
					</tr>
					<tr id="section_2">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_2">&#182;</a>
							</div>
							<p>This is the frontend for the <a href="index.html">curtsy engine</a>.
It accepts a single argument, either a <code>.cs</code> file or a <code>.csproj</code> file.</p>

<p>If the input is a csproj file, that file is probed for compilable cs files.</p>

						</td>
                        <td class="lines">
24<br />
25<br />
26<br />
27<br />
28<br />
29<br />
30<br />
31<br />
32<br />
33<br />
34<br />
35<br />
36<br />
37<br />
38<br />
39<br />
40<br />
41<br />
42<br />
43<br />
44<br />
45<br />
46<br />
47<br />
48<br />
49<br />
50<br />
51<br />
52<br />
53<br />
54<br />
55<br />
56<br />
57<br />
58<br />
59<br />
60<br />
61<br />
62<br />
                        </td>
						<td class="code">
							<pre><code class='prettyprint'>    class Program
    {
        static <a href="foundtypes.html">FoundTypes</a> _typeMap = new <a href="foundtypes.html">FoundTypes</a>();

        static int Main(string[] args)
        {
            if (args.Length != 1)
            {
                PrintUsage();
                return -1;
            }

            if (!File.Exists(args[0]))
            {
                Console.WriteLine(&quot;curtsy: file not found&quot;);
                return -2;
            }

            FileInfo fi = new FileInfo(args[0]);

            IEnumerable&lt;string&gt; sources;
            
            switch (Path.GetExtension(args[0]).ToLower())
            {
                case &quot;.cs&quot;:
                    sources = new string[] { fi.FullName };
                    break;
                default: // Assume MSBuild
                    sources = ProbeMSBuildForSources(fi.FullName).ToArray();
                    break;
            }

            var curtsy = new <a href="curtsy.html">Curtsy</a>(sources.ToList(), fi.DirectoryName);
            curtsy.Generate(&quot;docs&quot;);

            return 0;
        }

</code></pre>
						</td>
					</tr>
					<tr id="section_3">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_3">&#182;</a>
							</div>
							<p>Open specified MSBuild file and return relative .cs file paths for each <code>&lt;Compile&gt;</code> element</p>

						</td>
                        <td class="lines">
63<br />
64<br />
65<br />
66<br />
67<br />
68<br />
69<br />
70<br />
71<br />
72<br />
73<br />
74<br />
75<br />
76<br />
77<br />
78<br />
79<br />
80<br />
81<br />
82<br />
83<br />
84<br />
85<br />
86<br />
87<br />
88<br />
89<br />
90<br />
91<br />
92<br />
93<br />
94<br />
95<br />
96<br />
97<br />
98<br />
99<br />
100<br />
101<br />
102<br />
103<br />
104<br />
105<br />
106<br />
107<br />
108<br />
109<br />
110<br />
111<br />
112<br />
113<br />
114<br />
                        </td>
						<td class="code">
							<pre><code class='prettyprint'>        static List&lt;string&gt; ProbeMSBuildForSources(string projfile)
        {
            var doc = new XmlDocument();
            try
            {
                doc.Load(projfile);
            }
            catch (XmlException)
            {
                Console.WriteLine(&quot;curtsy: {0} is not an msbuild file.&quot;, Path.GetFileName(projfile));
                Environment.Exit(-3);
            }

            
            var nsmgr = new XmlNamespaceManager(doc.NameTable);
            string ns = &quot;&quot;;

            if (doc.DocumentElement.Attributes[&quot;xmlns&quot;] != null)
            {
                ns = &quot;msbuild:&quot;;
                string xmlns = doc.DocumentElement.Attributes[&quot;xmlns&quot;].Value;
                nsmgr.AddNamespace(&quot;msbuild&quot;, xmlns);
            }

            var nodes = doc.SelectNodes(String.Format(&quot;//{0}Compile[@Include]&quot;, ns), nsmgr);
            var result = new List&lt;string&gt;(nodes.Count);
            foreach (XmlNode node in nodes)
            {
                if (!node.Attributes[&quot;Include&quot;].Value.EndsWith(&quot;.cs&quot;))
                    continue;

                result.Add(Path.Combine(Path.GetDirectoryName(projfile), node.Attributes[&quot;Include&quot;].Value));
            }

            return result;
        }

        static void Verbose(string str, params object[] p)
        {
#if VERBOSE
            Console.WriteLine(&quot;curtsy: {0}&quot;, String.Format(str, p));
#endif
        }

        static void PrintUsage()
        {
            Console.WriteLine(&quot;Usage: curtsy &lt;file&gt;&quot;);
            Console.WriteLine(&quot;&lt;file&gt; can be a .cs or .csproj file&quot;);
        }
    }
}

</code></pre>
						</td>
					</tr>
			</tbody>
		</table>
	</div>
</body>
</html>