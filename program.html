<!DOCTYPE html />
<html>
<head>
	<title>Program.cs</title>
	<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
	<link href="explain.css" rel="stylesheet" media="all" type="text/css" />
	<script src="prettify.js" type="text/javascript"></script>
</head>
<body onload="prettyPrint()">
	<div id="container">
		<div id="background"></div>
			<div id="jump_to">
				Jump To &hellip;
				<div id="jump_wrapper">
					<div id="jump_page">
							<a class="source" href="explain.html">
								Explain.cs
							</a>
							<a class="source" href="extensions/stringregexextensions.html">
								Extensions\StringRegexExtensions.cs
							</a>
							<a class="source" href="parser,lexer.html">
								Parser,Lexer.cs
							</a>
							<a class="source" href="pathhelper.html">
								PathHelper.cs
							</a>
							<a class="source" href="program.html">
								Program.cs
							</a>
							<a class="source" href="properties/assemblyinfo.html">
								Properties\AssemblyInfo.cs
							</a>
							<a class="source" href="embeddedresources.html">
								EmbeddedResources.cs
							</a>
							<a class="source" href="section.html">
								Section.cs
							</a>
							<a class="source" href="templatebase.html">
								TemplateBase.cs
							</a>
							<a class="source" href="typemap.html">
								TypeMap.cs
							</a>
					</div>
				</div>
			</div>
		<table cellpadding="0" cellspacing="0">
			<thead>
				<tr>
					<th class="docs">
						<h1>Program.cs</h1>
					</th>
					<th class="code"></th>
				</tr>
			</thead>
			<tbody>
					<tr id="section_1">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_1">&#182;</a>
							</div>
							
						</td>
						<td class="code">
							<pre><code class='prettyprint'>#if DEBUG
#define VERBOSE
#endif

using System;
using System.CodeDom.Compiler;
using System.Collections.Generic;
using System.IO;
using System.Linq;
using System.Reflection;
using System.Text;
using System.Web.Razor;
using System.Xml;
using System.Collections;

namespace Explain
{
    class Program
    {
        
        static <a href="typemap.html">FoundTypes</a> _typeMap = new <a href="typemap.html">FoundTypes</a>();

        static int Main(string[] args)
        {
</code></pre>
						</td>
					</tr>
					<tr id="section_2">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_2">&#182;</a>
							</div>
							<p>Explain only expects one argument: the target file. That can be either a .cs file or msbuild .csproj file.</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>            if (args.Length != 1)
            {
                PrintUsage();
                return -1;
            }

            if (!File.Exists(args[0]))
            {
                Console.WriteLine(&quot;explain: file not found&quot;);
                return -2;
            }

            FileInfo fi = new FileInfo(args[0]);

            IEnumerable&lt;string&gt; sources;
            
            switch (Path.GetExtension(args[0]).ToLower())
            {
                case &quot;.cs&quot;:
                    sources = new string[] { fi.FullName };
                    break;
                default:
</code></pre>
						</td>
					</tr>
					<tr id="section_3">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_3">&#182;</a>
							</div>
							<p>Assume MSBuild</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>                    sources = ProbeMSBuildForSources(fi.FullName).ToArray();
                    break;
            }

            var explain = new <a href="explain.html">Explain</a>(sources.ToList(), fi.DirectoryName);
            explain.Generate(&quot;docs&quot;);

            return 0;
        }

</code></pre>
						</td>
					</tr>
					<tr id="section_4">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_4">&#182;</a>
							</div>
							<p>Open specified MSBuild file and return relative .cs file paths for each <code>&lt;Compile&gt;</code> element</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>        static List&lt;string&gt; ProbeMSBuildForSources(string projfile)
        {
            var doc = new XmlDocument();
            try
            {
                doc.Load(projfile);
            }
            catch (XmlException)
            {
                Console.WriteLine(&quot;explain: {0} is not an msbuild file.&quot;, Path.GetFileName(projfile));
                Environment.Exit(-3);
            }

            
            var nsmgr = new XmlNamespaceManager(doc.NameTable);
            string ns = &quot;&quot;;

            if (doc.DocumentElement.Attributes[&quot;xmlns&quot;] != null)
            {
                ns = &quot;msbuild:&quot;;
                string xmlns = doc.DocumentElement.Attributes[&quot;xmlns&quot;].Value;
                nsmgr.AddNamespace(&quot;msbuild&quot;, xmlns);
            }

            var nodes = doc.SelectNodes(String.Format(&quot;//{0}Compile[@Include]&quot;, ns), nsmgr);
            var result = new List&lt;string&gt;(nodes.Count);
            foreach (XmlNode node in nodes)
            {
                if (!node.Attributes[&quot;Include&quot;].Value.EndsWith(&quot;.cs&quot;))
                    continue;

                result.Add(Path.Combine(Path.GetDirectoryName(projfile), node.Attributes[&quot;Include&quot;].Value));
            }

            return result;
        }

        static void Verbose(string str, params object[] p)
        {
#if VERBOSE
            Console.WriteLine(&quot;explain: {0}&quot;, String.Format(str, p));
#endif
        }

        static void PrintUsage()
        {
            Console.WriteLine(&quot;Usage: explain &lt;file&gt;&quot;);
            Console.WriteLine(&quot;&lt;file&gt; can be a .cs or .csproj file&quot;);
        }
    }
}

</code></pre>
						</td>
					</tr>
			</tbody>
		</table>
	</div>
</body>
</html>